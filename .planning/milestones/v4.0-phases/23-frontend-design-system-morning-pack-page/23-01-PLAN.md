---
phase: 23-frontend-design-system-morning-pack-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/api/static/js/pms/theme.jsx
  - src/api/static/js/pms/components.jsx
  - src/api/static/js/Sidebar.jsx
  - src/api/static/js/App.jsx
  - src/api/static/dashboard.html
autonomous: true
requirements:
  - PMS-FE-DS-01
  - PMS-FE-DS-02
  - PMS-FE-MP-03

must_haves:
  truths:
    - "User can toggle between Dashboard mode and PMS mode via a prominent sidebar header switch"
    - "Switching to PMS mode shows 7 PMS navigation items (Morning Pack, Portfolio, Risk, Trade Blotter, Attribution, Strategies, Settings) and navigates to Morning Pack"
    - "Switching to Dashboard mode shows the original 5 navigation items (Strategies, Signals, Risk, Portfolio, Agents)"
    - "PMS design tokens define semantic colors for P&L (green/red), risk levels (green/yellow/red), and signal directions"
    - "Reusable PMS component library includes PMSCard, PMSTable, PMSBadge, PMSGauge, and PMSLayout grid components"
  artifacts:
    - path: "src/api/static/js/pms/theme.jsx"
      provides: "PMS design tokens — color palette, typography, spacing, semantic mappings"
      contains: "PMS_COLORS"
    - path: "src/api/static/js/pms/components.jsx"
      provides: "Reusable PMS component library — PMSCard, PMSTable, PMSBadge, PMSGauge, PMSLayout"
      contains: "PMSCard"
    - path: "src/api/static/js/Sidebar.jsx"
      provides: "Mode switch between Dashboard and PMS with separate nav item sets"
      contains: "PMS_NAV_ITEMS"
    - path: "src/api/static/js/App.jsx"
      provides: "PMS routes for 7 PMS pages with mode-aware layout"
      contains: "morning-pack"
    - path: "src/api/static/dashboard.html"
      provides: "Script tags loading pms/theme.jsx and pms/components.jsx"
      contains: "pms/theme.jsx"
  key_links:
    - from: "src/api/static/js/pms/components.jsx"
      to: "src/api/static/js/pms/theme.jsx"
      via: "PMS_COLORS and PMS_TYPOGRAPHY constants"
      pattern: "PMS_COLORS"
    - from: "src/api/static/js/Sidebar.jsx"
      to: "src/api/static/js/App.jsx"
      via: "mode state prop and NavLink paths"
      pattern: "pmsMode"
    - from: "src/api/static/dashboard.html"
      to: "src/api/static/js/pms/theme.jsx"
      via: "script type=text/babel src loading"
      pattern: "pms/theme.jsx"
---

<objective>
PMS design system foundation: color palette with semantic tokens for P&L/risk/direction, reusable component library (cards, tables, gauges, badges, layout grid), and mode-switch sidebar navigation that lets the user toggle between the v3.0 Dashboard and the new PMS with 7 sub-pages.

Purpose: Establishes the visual language and navigation shell for all PMS frontend pages (Phases 23-26). Every PMS page will import from theme.jsx and components.jsx, so these must be correct and complete before page development begins.

Output: 5 files (2 new PMS library files, 3 modified existing files) providing the design system, component library, and mode-switch navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/api/static/dashboard.html
@src/api/static/js/App.jsx
@src/api/static/js/Sidebar.jsx
@src/api/static/js/hooks.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: PMS design tokens and reusable component library</name>
  <files>
    src/api/static/js/pms/theme.jsx
    src/api/static/js/pms/components.jsx
  </files>
  <action>
Create directory `src/api/static/js/pms/` for all PMS-specific frontend modules.

**theme.jsx** — PMS design tokens exposed on `window.PMS_THEME`:

```
PMS_COLORS = {
  // Background layers (dark theme, Bloomberg-dense)
  bg: { primary: '#0d1117', secondary: '#161b22', tertiary: '#21262d', elevated: '#30363d' },
  // Text
  text: { primary: '#e6edf3', secondary: '#8b949e', muted: '#484f58', inverse: '#0d1117' },
  // P&L semantic (locked: classic red/green)
  pnl: { positive: '#3fb950', negative: '#f85149', neutral: '#8b949e' },
  // Risk levels (locked: traffic light)
  risk: { ok: '#3fb950', warning: '#d29922', breach: '#f85149' },
  // Signal directions
  direction: { long: '#3fb950', short: '#f85149', neutral: '#8b949e', hold: '#d29922' },
  // Conviction color scale (0.0 to 1.0)
  conviction: { low: '#8b949e', medium: '#d29922', high: '#3fb950', veryHigh: '#58a6ff' },
  // Borders and accents
  border: { default: '#30363d', subtle: '#21262d', accent: '#58a6ff' },
  // Agent card accent colors (one per agent)
  agent: {
    inflation: '#f0883e', monetary: '#a371f7', fiscal: '#3fb950',
    fx: '#58a6ff', cross_asset: '#d29922'
  }
}

PMS_TYPOGRAPHY = {
  fontFamily: "'JetBrains Mono', 'SF Mono', 'Fira Code', 'Consolas', monospace",
  sizes: { xs: '0.625rem', sm: '0.75rem', base: '0.8125rem', lg: '0.9375rem', xl: '1.125rem', '2xl': '1.5rem' },
  weights: { normal: 400, medium: 500, semibold: 600, bold: 700 }
}

PMS_SPACING = { xs: '0.25rem', sm: '0.5rem', md: '0.75rem', lg: '1rem', xl: '1.5rem' }
```

Include helper functions:
- `pnlColor(value)` — returns PMS_COLORS.pnl.positive/negative/neutral based on sign
- `riskColor(level)` — returns ok/warning/breach color from string level
- `directionColor(dir)` — returns long/short/neutral/hold color
- `convictionColor(score)` — returns color based on numeric score (< 0.4 low, < 0.6 medium, < 0.8 high, >= 0.8 veryHigh)
- `formatPnL(value)` — returns formatted string with +/- sign and 2 decimal places
- `formatPercent(value)` — returns percentage string with sign
- `formatNumber(value, decimals)` — generic number formatter

Expose all via `window.PMS_THEME = { PMS_COLORS, PMS_TYPOGRAPHY, PMS_SPACING, pnlColor, riskColor, directionColor, convictionColor, formatPnL, formatPercent, formatNumber }`.

**components.jsx** — Reusable PMS UI component library exposed on `window`:

All components use PMS_THEME constants (accessed via `window.PMS_THEME`). Bloomberg-dense style: minimal padding, small text, maximum information density. All components use inline styles referencing PMS_COLORS for the dark theme (not Tailwind color classes for PMS-specific colors, though Tailwind utility classes are fine for layout like flex, grid, gap, etc.).

Components to implement:

1. `PMSCard({ title, subtitle, children, accentColor, className })` — dark card with optional colored left border accent. Compact padding (8px-12px). Title in PMS_TYPOGRAPHY.sizes.sm, uppercase, letter-spacing 0.05em.

2. `PMSTable({ columns, data, onRowClick, compact })` — dense data table. Columns: `[{ key, label, align, format }]`. Alternating row backgrounds (bg.secondary/bg.tertiary). Compact mode reduces cell padding. Header row in PMS_COLORS.text.muted with uppercase.

3. `PMSBadge({ label, variant, size })` — small badge/pill. Variants: 'positive', 'negative', 'warning', 'neutral', 'info'. Maps to PMS_COLORS. Sizes: 'sm' (tiny inline), 'md' (standard).

4. `PMSGauge({ value, max, label, color, size })` — simple horizontal bar gauge. Shows value/max as filled bar width percentage. Label below. Color from PMS_COLORS. Size 'sm' (thin) or 'md' (standard).

5. `PMSLayout({ children })` — grid container. Uses CSS grid: `grid-template-columns: repeat(auto-fit, minmax(300px, 1fr))` with gap of PMS_SPACING.md. Bloomberg-dense: minimal outer padding.

6. `PMSMetricCard({ label, value, change, prefix, suffix })` — tiny metric display for ticker strips. Label on top (muted, xs), value large (lg, bold), change below with color-coded +/- arrow.

7. `PMSSkeleton({ width, height, className })` — loading placeholder with pulse animation. Uses bg.tertiary color.

8. `PMSAlertBanner({ alerts, onDismiss })` — sticky top banner for active alerts. Color-coded by severity (risk colors). Shows dismiss X button per alert. Auto-stacks multiple alerts vertically. Empty state returns null.

Expose each on window: `window.PMSCard = PMSCard`, etc.
  </action>
  <verify>
Both files exist:
```bash
ls -la src/api/static/js/pms/theme.jsx src/api/static/js/pms/components.jsx
```
Files have substantive content (theme > 80 lines, components > 200 lines):
```bash
wc -l src/api/static/js/pms/theme.jsx src/api/static/js/pms/components.jsx
```
  </verify>
  <done>
theme.jsx exports PMS_COLORS with bg/text/pnl/risk/direction/conviction/border/agent sections, PMS_TYPOGRAPHY with monospace font family, PMS_SPACING, and 7 helper functions. components.jsx exports 8 reusable components (PMSCard, PMSTable, PMSBadge, PMSGauge, PMSLayout, PMSMetricCard, PMSSkeleton, PMSAlertBanner) all using PMS_THEME constants for Bloomberg-dense dark styling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Mode-switch sidebar, PMS routes, and dashboard.html integration</name>
  <files>
    src/api/static/js/Sidebar.jsx
    src/api/static/js/App.jsx
    src/api/static/dashboard.html
  </files>
  <action>
**Sidebar.jsx** — Add mode switch architecture (locked decision: "top-level mode switch between Dashboard and PMS"):

1. Add `pmsMode` and `onModeChange` props to `Sidebar({ alertCount, pmsMode, onModeChange })`.

2. Add PMS_NAV_ITEMS array with 7 items (locked order: Morning Pack, Portfolio, Risk, Trade Blotter, Attribution, Strategies, Settings):
```javascript
const PMS_NAV_ITEMS = [
  { to: "/pms/morning-pack", label: "Morning Pack", Icon: IconSunrise },
  { to: "/pms/portfolio",    label: "Portfolio",    Icon: IconBriefcase },
  { to: "/pms/risk",         label: "Risk",         Icon: IconShield },
  { to: "/pms/blotter",      label: "Trade Blotter",Icon: IconList },
  { to: "/pms/attribution",  label: "Attribution",  Icon: IconPieChart },
  { to: "/pms/strategies",   label: "Strategies",   Icon: IconChartBar },
  { to: "/pms/settings",     label: "Settings",     Icon: IconSettings },
];
```

3. Add new SVG icon components for PMS items: `IconSunrise` (for Morning Pack — distinct from dashboard), `IconList` (for Trade Blotter), `IconPieChart` (for Attribution), `IconSettings` (for Settings). Reuse existing `IconShield`, `IconBriefcase`, `IconChartBar` for the shared ones.

4. Replace the logo/brand area with a mode switch toggle (locked decision: "sidebar header toggle"):
```jsx
<div className="flex items-center justify-between px-4 py-3 border-b border-gray-800">
  <span className="text-green-500 font-mono text-xl font-bold flex-shrink-0">MT</span>
  {!collapsed && (
    <div className="flex bg-gray-800 rounded-md p-0.5">
      <button
        onClick={() => onModeChange(false)}
        className={`px-2 py-1 text-xs rounded ${!pmsMode ? 'bg-blue-600 text-white' : 'text-gray-400 hover:text-gray-200'}`}
      >
        Dashboard
      </button>
      <button
        onClick={() => onModeChange(true)}
        className={`px-2 py-1 text-xs rounded ${pmsMode ? 'bg-blue-600 text-white' : 'text-gray-400 hover:text-gray-200'}`}
      >
        PMS
      </button>
    </div>
  )}
  {collapsed && (
    <button
      onClick={() => onModeChange(!pmsMode)}
      className="text-xs px-1 py-0.5 rounded bg-gray-800 text-gray-400 hover:text-gray-200"
      title={pmsMode ? "Switch to Dashboard" : "Switch to PMS"}
    >
      {pmsMode ? "P" : "D"}
    </button>
  )}
</div>
```

5. Conditionally render NAV_ITEMS or PMS_NAV_ITEMS based on `pmsMode` prop. The existing NAV_ITEMS and navigation logic stays exactly the same for Dashboard mode.

6. When `pmsMode` is true, apply Bloomberg-dense dark styling: sidebar background changes from `bg-gray-900` to a slightly different shade using inline style `backgroundColor: '#0d1117'` (PMS_COLORS.bg.primary).

**App.jsx** — Add PMS mode state and routing:

1. Add `pmsMode` state: `const [pmsMode, setPmsMode] = useState(false)`.

2. Add mode change handler that navigates to Morning Pack when switching to PMS:
```javascript
const navigate = useNavigate(); // inside HashRouter
const handleModeChange = (isPms) => {
  setPmsMode(isPms);
  if (isPms) navigate('/pms/morning-pack');
  else navigate('/strategies');
};
```
Note: Need to restructure so that the mode state and navigate live inside HashRouter. Extract an inner `AppContent` component that uses `useNavigate()`, or use `window.location.hash` for navigation since this is HashRouter.

3. Add placeholder PMS page components (simple divs with page name — actual pages built in plans 23-02, 24, 25, 26):
```javascript
function PMSPlaceholder({ title }) {
  return (
    <div style={{ color: '#e6edf3', padding: '2rem', fontFamily: "'JetBrains Mono', monospace" }}>
      <h1 style={{ fontSize: '1.5rem', marginBottom: '0.5rem' }}>{title}</h1>
      <p style={{ color: '#8b949e' }}>Coming soon...</p>
    </div>
  );
}
```

4. Add PMS routes inside `<Routes>`:
```jsx
<Route path="/pms/morning-pack" element={<MorningPackPage />} />
<Route path="/pms/portfolio" element={<PMSPlaceholder title="Position Book" />} />
<Route path="/pms/risk" element={<PMSPlaceholder title="Risk Monitor" />} />
<Route path="/pms/blotter" element={<PMSPlaceholder title="Trade Blotter" />} />
<Route path="/pms/attribution" element={<PMSPlaceholder title="Performance Attribution" />} />
<Route path="/pms/strategies" element={<PMSPlaceholder title="PMS Strategies" />} />
<Route path="/pms/settings" element={<PMSPlaceholder title="PMS Settings" />} />
```

5. Pass `pmsMode` and `onModeChange` to `<Sidebar>` and `<Layout>`. When in PMS mode, the Layout main area should use PMS background color (inline style backgroundColor: '#0d1117' from PMS_COLORS.bg.primary instead of Tailwind bg-gray-950).

**dashboard.html** — Add script tags for new PMS files:

1. Add PMS script tags after hooks.jsx but before Sidebar.jsx (dependency order):
```html
<script type="text/babel" src="/static/js/pms/theme.jsx"></script>
<script type="text/babel" src="/static/js/pms/components.jsx"></script>
```

2. Add JetBrains Mono font from Google Fonts CDN in the `<head>`:
```html
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
```

3. Extend `tailwind.config` colors with PMS-specific semantic colors for Tailwind utility usage alongside inline styles:
```javascript
pms: {
  bg: '#0d1117',
  surface: '#161b22',
  border: '#30363d',
  green: '#3fb950',
  red: '#f85149',
  yellow: '#d29922',
  blue: '#58a6ff',
}
```
  </action>
  <verify>
1. Open dashboard in browser or verify file structure:
```bash
grep -c "pmsMode" src/api/static/js/Sidebar.jsx
grep -c "morning-pack" src/api/static/js/App.jsx
grep -c "pms/theme.jsx" src/api/static/dashboard.html
```
All three should return >= 1.

2. Verify no syntax errors by checking file sizes are reasonable:
```bash
wc -l src/api/static/js/Sidebar.jsx src/api/static/js/App.jsx src/api/static/dashboard.html
```
  </verify>
  <done>
Sidebar has mode toggle in header area switching between "Dashboard" and "PMS" labels. PMS mode shows 7 nav items in daily workflow order (Morning Pack first). Dashboard mode shows original 5 nav items unchanged. App.jsx has PMS routes with placeholder components for 6 future pages and MorningPackPage (built in plan 02). Switching to PMS mode navigates to /pms/morning-pack. dashboard.html loads pms/theme.jsx and pms/components.jsx with JetBrains Mono font.
  </done>
</task>

</tasks>

<verification>
1. All 5 files exist and have expected content:
```bash
ls -la src/api/static/js/pms/theme.jsx src/api/static/js/pms/components.jsx
wc -l src/api/static/js/Sidebar.jsx src/api/static/js/App.jsx src/api/static/dashboard.html
```

2. Design tokens are accessible:
```bash
grep "PMS_COLORS" src/api/static/js/pms/theme.jsx | head -3
grep "window.PMS_THEME" src/api/static/js/pms/theme.jsx
```

3. Component library exports:
```bash
grep "window.PMS" src/api/static/js/pms/components.jsx | wc -l
```
Should show 8+ window exports.

4. Mode switch in sidebar:
```bash
grep "pmsMode" src/api/static/js/Sidebar.jsx | head -3
grep "PMS_NAV_ITEMS" src/api/static/js/Sidebar.jsx | head -1
```

5. PMS routes in App:
```bash
grep "/pms/" src/api/static/js/App.jsx | wc -l
```
Should show 7+ PMS route entries.

6. Script loading order in HTML:
```bash
grep "pms/" src/api/static/dashboard.html
```
Should show theme.jsx and components.jsx loaded before Sidebar.jsx.
</verification>

<success_criteria>
- PMS_COLORS defines semantic colors for P&L (positive/negative), risk (ok/warning/breach), direction (long/short/neutral/hold), conviction scale, and per-agent accents
- 8 reusable PMS components exported on window, all using dark theme Bloomberg-dense styling
- Sidebar header has prominent Dashboard/PMS toggle switch
- PMS mode shows 7 navigation items in correct order; Dashboard mode shows original 5 items
- Switching to PMS navigates to Morning Pack; switching to Dashboard navigates to Strategies
- dashboard.html loads PMS files with JetBrains Mono font
- All existing v3.0 Dashboard functionality is preserved when in Dashboard mode
</success_criteria>

<output>
After completion, create `.planning/phases/23-frontend-design-system-morning-pack-page/23-01-SUMMARY.md`
</output>
