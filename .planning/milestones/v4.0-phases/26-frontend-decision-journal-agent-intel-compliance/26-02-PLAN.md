---
phase: 26-frontend-decision-journal-agent-intel-compliance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/api/static/js/pms/pages/AgentIntelPage.jsx
autonomous: true
requirements:
  - PMS-FE-AI-01
  - PMS-FE-AI-02

must_haves:
  truths:
    - "Agent Intelligence Hub shows 5 agent cards in a responsive 2-3 column grid with Cross-Asset agent in a wider featured position"
    - "Each agent card displays: agent name, overall signal direction (bullish/bearish/neutral), confidence score, and top 3 key drivers"
    - "Each agent card includes a mini sparkline showing last 30 days of confidence/signal evolution"
    - "Cross-Asset card has an expandable 'Read full narrative' section that reveals the LLM-generated narrative text inline"
    - "Agent cards use per-agent accent colors from PMS_COLORS.agent (inflation=orange, monetary=purple, fiscal=green, fx=blue, cross_asset=gold)"
  artifacts:
    - path: "src/api/static/js/pms/pages/AgentIntelPage.jsx"
      provides: "Agent Intelligence Hub page with 5 agent cards, sparklines, and narrative display"
      min_lines: 350
  key_links:
    - from: "src/api/static/js/pms/pages/AgentIntelPage.jsx"
      to: "/api/v1/agents"
      via: "fetch for agent list and metadata"
      pattern: "fetch.*api/v1/agents"
    - from: "src/api/static/js/pms/pages/AgentIntelPage.jsx"
      to: "/api/v1/agents/{id}/latest"
      via: "sequential fetch for each agent's latest report"
      pattern: "fetch.*agents.*latest"
---

<objective>
Build the Agent Intelligence Hub page -- a card grid displaying the 5 analytical agents with their latest signals, confidence scores, key drivers, sparklines, and the Cross-Asset LLM narrative.

Purpose: The Agent Intelligence Hub gives the portfolio manager a single view of all AI agent intelligence. Each card summarizes an agent's current view (bullish/bearish/neutral) with supporting drivers and risks, while the Cross-Asset narrative provides the synthesized market story.

Output: `AgentIntelPage.jsx` component exposed on `window.AgentIntelPage`, fetching from existing Agents API endpoints.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-frontend-decision-journal-agent-intel-compliance/26-CONTEXT.md
@.planning/phases/23-frontend-design-system-morning-pack-page/23-01-SUMMARY.md

Key existing files to reference for patterns:
@src/api/static/js/pms/theme.jsx (PMS_COLORS.agent accent colors)
@src/api/static/js/pms/components.jsx (PMSCard, PMSBadge, PMSSkeleton)
@src/api/static/js/pages/AgentsPage.jsx (v3.0 agents page pattern -- cards with signals, narrative)
@src/api/routes/agents.py (GET /agents, GET /agents/{id}/latest -- 5 agents: inflation_agent, monetary_agent, fiscal_agent, fx_agent, cross_asset_agent)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AgentIntelPage with card grid, sparklines, and Cross-Asset narrative</name>
  <files>src/api/static/js/pms/pages/AgentIntelPage.jsx</files>
  <action>
Create `src/api/static/js/pms/pages/AgentIntelPage.jsx` implementing the Agent Intelligence Hub. Use PMS_COLORS, PMS_TYPOGRAPHY, PMS_SPACING from `window.PMS_THEME` and reusable components from `window` (PMSCard, PMSBadge, PMSSkeleton).

**Page Header:**
- Title "Agent Intelligence Hub" in PMS_TYPOGRAPHY.sizes['2xl']
- Subtitle "Latest agent signals and AI-driven analysis" in secondary text
- Last updated timestamp (from most recent report)

**Data Fetching:**
- On mount, fetch `GET /api/v1/agents` for agent list
- Then sequentially fetch `GET /api/v1/agents/{agent_id}/latest` for each of the 5 agents (per established pattern from Phase 19: per-agent sequential fetch to avoid server overload)
- Parse each report: extract signals array (direction, confidence, value), narrative text, and agent metadata
- If API fails, use deterministic sample data with realistic signals per agent

**Agent Card Grid Layout:**
- CSS grid: 3 columns on wide screens, 2 columns on medium, 1 column on narrow
- Cross-Asset agent card spans 2 columns on wide screens (featured position) -- use `gridColumn: 'span 2'` for the cross_asset_agent card on wide layouts
- Grid gap: PMS_SPACING.md

**Individual Agent Card (AgentCard component):**
- Card background: PMS_COLORS.bg.secondary with left border accent in agent color (PMS_COLORS.agent[agentKey])
- **Header row**: Agent name (bold), signal direction badge (BULLISH/BEARISH/NEUTRAL using directionColor), confidence score as percentage
- **Signal summary**: Overall direction icon (arrow up/down/right), confidence as progress bar (filled portion in agent accent color)
- **Top 3 Key Drivers**: Bullet list of top 3 items from signals[].metadata or narrative keywords. If signals array has items, extract signal_id and value as driver descriptions. Show as compact text rows.
- **Risks**: If the report narrative mentions risks, extract and show. Otherwise show "No elevated risks" in muted text.
- **Mini Sparkline (last 30 days)**: SVG polyline element (per Phase 24 pattern: SVG polyline spark chart, not Recharts for inline sparklines). Generate 30 data points from sample data (or actual historical if available). SVG viewBox "0 0 120 30", polyline with agent accent color stroke, no fill, strokeWidth 1.5.

**Cross-Asset Featured Card (extends AgentCard):**
- Same card structure but wider (2-column span)
- Additional section: "Cross-Asset Narrative" with expandable toggle
- "Read full narrative" button that toggles narrative text visibility
- When expanded, show narrative text in a scrollable pre-formatted div (max-height 300px, overflow-y auto) with PMS_TYPOGRAPHY.fontFamily monospace styling
- Narrative text should display the `narrative` field from the Cross-Asset agent's latest report

**Agent Key Mapping:**
Map agent_ids to display info:
```
inflation_agent  -> name: "Inflation",       key: "inflation",    accent: PMS_COLORS.agent.inflation
monetary_agent   -> name: "Monetary Policy",  key: "monetary",     accent: PMS_COLORS.agent.monetary
fiscal_agent     -> name: "Fiscal",           key: "fiscal",       accent: PMS_COLORS.agent.fiscal
fx_agent         -> name: "FX Equilibrium",   key: "fx",           accent: PMS_COLORS.agent.fx
cross_asset_agent -> name: "Cross-Asset",     key: "cross_asset",  accent: PMS_COLORS.agent.cross_asset
```

**Signal Direction Derivation:**
- From agent report signals array: if majority direction is "LONG"/"BULLISH" -> BULLISH, "SHORT"/"BEARISH" -> BEARISH, else NEUTRAL
- Confidence: average confidence from all signals, formatted as percentage

**Sample Data Fallback:**
- 5 agent reports with realistic signals:
  - Inflation: BEARISH, 72% confidence, drivers: "IPCA momentum", "Focus expectations", "Wage pressure"
  - Monetary: NEUTRAL, 65% confidence, drivers: "Selic at terminal", "Taylor Rule neutral", "Term premium"
  - Fiscal: BEARISH, 58% confidence, drivers: "Debt trajectory", "Primary deficit", "Revenue shortfall"
  - FX: BULLISH, 68% confidence, drivers: "Carry advantage", "Flow positive", "BEER undervalued"
  - Cross-Asset: NEUTRAL, 61% confidence, drivers: "Mixed regime signals", "VIX moderate", "Correlation breakdown", narrative: 3-4 paragraph sample text about macro conditions

**Loading State:**
- 5 PMSSkeleton cards in grid layout while data loads

Expose component on `window.AgentIntelPage`.
  </action>
  <verify>
File exists at `src/api/static/js/pms/pages/AgentIntelPage.jsx` with 350+ lines. Contains: AgentCard component, grid layout with Cross-Asset spanning 2 columns, SVG sparklines, expandable narrative section, sample data fallback, and `window.AgentIntelPage` assignment.
  </verify>
  <done>
Agent Intelligence Hub page displays 5 agent cards in responsive grid with Cross-Asset featured position, each showing signal direction badge, confidence score, top 3 key drivers, and 30-day SVG sparkline. Cross-Asset card includes expandable LLM narrative section. Cards use per-agent accent colors from PMS_COLORS.agent.
  </done>
</task>

</tasks>

<verification>
1. File `src/api/static/js/pms/pages/AgentIntelPage.jsx` exists and is >= 350 lines
2. Card grid is responsive (3 columns wide, 2 medium, 1 narrow)
3. Cross-Asset card spans 2 columns on wide screens
4. Each card shows: agent name, direction badge, confidence, top 3 drivers, SVG sparkline
5. Cross-Asset card has "Read full narrative" expandable section
6. Per-agent accent colors used (orange, purple, green, blue, gold)
7. Sample data renders when API unavailable
8. Component exposed on window.AgentIntelPage
</verification>

<success_criteria>
- AgentIntelPage.jsx renders the 5 agent cards with correct accent colors and Bloomberg-dense dark styling
- Card grid layout is responsive with Cross-Asset in featured wide position
- Signal direction (BULLISH/BEARISH/NEUTRAL) correctly derived from agent report data
- SVG sparklines render 30-day signal evolution on each card
- Cross-Asset narrative expands/collapses inline
- Sample data provides meaningful demo when API unavailable
</success_criteria>

<output>
After completion, create `.planning/phases/26-frontend-decision-journal-agent-intel-compliance/26-02-SUMMARY.md`
</output>
